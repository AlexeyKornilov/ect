/*!
 * ECT CoffeeScript template engine v0.2.3
 * https://github.com/baryshev/ect
 *
 * Copyright 2012, Vadim M. Baryshev <vadimbaryshev@gmail.com>
 * Licensed under the MIT license
 * https://github.com/baryshev/ect/LICENSE
 *
 * Includes parts of node
 * https://github.com/joyent/node
 * Copyright Joyent, Inc. and other Node contributors
 * Released under the MIT license
 *
 * Includes Cross-Browser Split 1.0.1
 * http://xregexp.com/
 * Copyright Steven Levithan <stevenlevithan.com>
 * Released under the MIT license
 */
(function(){"use strict";var fs,path,CoffeeScript,ECT=function(options){if(!(this instanceof ECT))return new ECT(options);var ect=this;this.options={open:"<%",close:"%>",ext:"",cache:!1,watch:!1,root:""};var trimExp=/^\s+|\s+$/g,newlineExp=/\n/g,cache={},loaders={},watchers={},indentChars={":":":",">":">"},regExpEscape=function(e){return String(e).replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},iterate=function(e,t,n){if(!e.length)return n();var r=0;for(var i=0;i<e.length;i++)t(e[i],function(t){t?(n(t),n=function(){}):(r++,r===e.length&&n())})},parse=function(e){var t=1,n=["__ectTemplate.buffer"],r=0,i=n[r]+".push '",s,o=e.split(new RegExp(regExpEscape(ect.options.open)+"((?:.|[\r\n])+?)(?:"+regExpEscape(ect.options.close)+"|$)")),u,a,f,l,c,h,p="",d=!1,v=[],m=-1;for(var g=0;g<o.length;g++){u=o[g],a="";if(g%2===1){f="__ectTemplate.line = "+t;switch(u.charAt(0)){case"=":l="', __ectTemplate.empty("+f+"), __ectTemplate.escape(",c="), '",h="",u=u.substr(1);break;case"-":l="', __ectTemplate.empty("+f+"), (",c="), '",h="",u=u.substr(1);break;default:l="'\n"+f+"",c="\n"+n[r]+".push '",h="\n"}u=u.replace(trimExp,""),a=u.split(/[^a-z]+/)[0];if(s=indentChars[u.charAt(u.length-1)])u=u.replace(/:$/,"").replace(trimExp,""),s===">"&&(n.push("__ectBuffer"+r),c="\n__ectBuffer"+r+" = []",r++,c+="\n"+n[r]+".push '",a="function"),v.push(a),m++,a!=="block"&&(d=!0);switch(a){case"partial":l="', __ectTemplate.empty("+f+"), (",c="), '",i+=l.replace(newlineExp,"\n"+p)+u+c.replace(newlineExp,"\n"+p);break;case"content":l="', __ectTemplate.empty("+f+"), (",c="), '",u==="content"&&(c="()"+c),i+=l.replace(newlineExp,"\n"+p)+u+c.replace(newlineExp,"\n"+p);break;case"end":l="'";switch(v[m]){case"block":l="'\n__ectTemplate.blockEnd(",c=")\n"+n[r]+".push '",i+=l.replace(newlineExp,"\n"+p)+c.replace(newlineExp,"\n"+p);break;case"when":c="\n"+n[r]+".push ''",i+=l.replace(newlineExp,"\n"+p)+c.replace(newlineExp,"\n"+p),p=p.substr(2);break;case"function":l="'\n"+n[r]+".join ''",i+=l.replace(newlineExp,"\n"+p),p=p.substr(2),n.pop(),r--,c="\n"+n[r]+".push '",i+=c.replace(newlineExp,"\n"+p);break;case"switch":l="\n"+f+"",p=p.substr(2);default:v[m-1]==="switch"&&(c=""),p=p.substr(2),i+=l.replace(newlineExp,"\n"+p)+c.replace(newlineExp,"\n"+p)}v.pop(),m--;break;case"else":v[m-1]==="switch"?l="":l="'",i+=l.replace(newlineExp,"\n"+p),v[m-1]==="if"&&(v.splice(-2,1),m--,p=p.substr(2)),i+=(h.length?h+p:"")+u,d&&(p+="  ",d=!1),i+=c.replace(newlineExp,"\n"+p);break;case"switch":i+=l.replace(newlineExp,"\n"+p)+(h.length?h+p:"")+u,d&&(p+="  ",d=!1);break;case"when":i+=(h.length?h+p:"")+u,d&&(p+="  ",d=!1),i+=c.replace(newlineExp,"\n"+p);break;default:i+=l.replace(newlineExp,"\n"+p)+(h.length?h+p:"")+u,d&&(p+="  ",d=!1),i+=c.replace(newlineExp,"\n"+p)}}else v[m]!=="switch"&&(i+=u.replace(/[\\']/g,"\\$&").replace(/\r/g,"").replace(newlineExp,"\\n"));t+=u.split(newlineExp).length-1}return i+="'\nreturn __ectTemplate.buffer",new Function("__ectTemplate","partial","extend","block","content",CoffeeScript.compile(i,{bare:!0}))},loaded=function(e,t,n){var r=loaders[t];delete loaders[t];for(var i=0;i<r.length;i++)r[i](e,n)},read=function(file,callback){if(Object.prototype.toString.call(ect.options.root)==="[object Object]")try{var data=eval("(options.root."+file+")");Object.prototype.toString.call(data)==="[object String]"?callback(undefined,data):callback(new Error("Failed to load template "+file))}catch(e){callback(e)}else fs.readFile(file,"utf8",callback)},load=function(e,t){ect.options.cache&&cache[e]?t&&t(undefined,cache[e]):loaders[e]?t&&loaders[e].push(t):(loaders[e]=[],t&&loaders[e].push(t),read(e,function(t,n){if(t)loaded(t,e);else try{var r=parse(n);ect.options.cache&&(cache[e]=r),loaded(undefined,e,r),ect.options.watch&&(watchers[e]=fs.watch(e,function(){watchers[e].close(),delete watchers[e],delete cache[e]}))}catch(i){i.message=i.message.replace(/ on line \d+/,"")+" in "+e,loaded(i,e)}}))},Template=function(e,t,n){this.file=e,Object.prototype.toString.call(ect.options.root)==="[object String]"&&(this.file=path.normalize((ect.options.root.length?ect.options.root+"/":"")+e+ect.options.ext)),this.data=t;if(n)for(var r in n)this.data[r]=n[r];this.buffer=[],this.tmpBuffer=undefined,this.line=1,this.partials=[],this.childData=[],this.childError=undefined,this.childCallback=undefined,this.callback=undefined,this.blocks={}};Template.prototype.blockStart=function(e){this.tmpBuffer=this.buffer,this.blocks[e]||(this.blocks[e]=[]),this.blocks[e].length?this.buffer=[]:this.buffer=this.blocks[e]},Template.prototype.blockEnd=function(){this.buffer=this.tmpBuffer,delete this.tmpBuffer},Template.prototype.partial=function(e,t){var n=[],r=new Template(e,this.data,t);return r.blocks=this.blocks,this.partials.push(function(e){r.render(function(t,r){t||n.push(r),e(t)})}),n},Template.prototype.extend=function(e,t){var n=new Template(e,this.data,t),r=this.callback;return n.blocks=this.blocks,this.callback=function(e,t){n.render(r),e?(n.childError=e,n.childCallback&&n.childCallback(e)):(n.childData.push(t),n.childCallback&&n.childCallback())},n.partials.push(function(e){n.childError?e(n.childError):n.childData.length?e():n.childCallback=e}),""},Template.prototype.content=function(e){return e&&e.length?(this.blocks[e]||(this.blocks[e]=[]),this.blocks[e]):this.childData},Template.prototype.render=function(e){var t=this;this.callback=e,load(this.file,function(e,n){if(e)t.callback&&t.callback(e);else try{var r=n.call(t.data,t,function(){return t.partial.apply(t,arguments)},function(){return t.extend.apply(t,arguments)},function(){return t.blockStart.apply(t,arguments)},function(){return t.content.apply(t,arguments)});iterate(t.partials,function(e,t){e(t)},function(e){var n="";if(!e)for(var i=0;i<r.length;i++){if(typeof r[i]=="undefined")continue;n+=Array.isArray(r[i])?r[i].join(""):r[i]}t.callback&&t.callback(e,n)})}catch(i){i.message=i.message+" in "+t.file+" on line "+t.line,t.callback&&t.callback(i)}})},Template.prototype.escape=function(e){return typeof e=="undefined"?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Template.prototype.empty=function(){return""},this.configure=function(e){e=e||{};for(var t in e){if(typeof this.options[t]=="undefined")continue;this.options[t]=e[t]}},this.render=function(e,t,n){typeof t=="function"&&(n=t,t={});var r=new Template(e,t);r.render(n)},this.configure(options)};if(typeof module!="undefined"&&module.exports)fs=require("fs"),path=require("path"),CoffeeScript=require("coffee-script"),module.exports=ECT;else{Array.prototype.filter||(Array.prototype.filter=function(e,t){var n=this.length,r=[],i,s;if(typeof e!="function")throw new TypeError;for(i=0;i<n;i++)i in this&&(s=this[i],e.call(t,s,i,this)&&r.push(s));return r}),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var cbSplit;cbSplit||(cbSplit=function(e,t,n){if(Object.prototype.toString.call(t)!=="[object RegExp]")return cbSplit.nativeSplit.call(e,t,n);var r=[],i=0,s=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":""),o,u,a,f;t=new RegExp(t.source,s+"g"),e+="",cbSplit.compliantExecNpcg||(o=new RegExp("^"+t.source+"$(?!\\s)",s));if(n===undefined||+n<0)n=Infinity;else{n=Math.floor(+n);if(!n)return[]}while(u=t.exec(e)){a=u.index+u[0].length;if(a>i){r.push(e.slice(i,u.index)),!cbSplit.compliantExecNpcg&&u.length>1&&u[0].replace(o,function(){var e;for(e=1;e<arguments.length-2;e++)arguments[e]===undefined&&(u[e]=undefined)}),u.length>1&&u.index<e.length&&Array.prototype.push.apply(r,u.slice(1)),f=u[0].length,i=a;if(r.length>=n)break}t.lastIndex===u.index&&t.lastIndex++}return i===e.length?(f||!t.test(""))&&r.push(""):r.push(e.slice(i)),r.length>n?r.slice(0,n):r},cbSplit.compliantExecNpcg=/()??/.exec("")[1]===undefined,cbSplit.nativeSplit=String.prototype.split),String.prototype.split=function(e,t){return cbSplit(this,e,t)},window.ECT=ECT,CoffeeScript=window.CoffeeScript,path=function(){var e=function(e,t){var n=0,r,i;for(r=e.length-1;r>=0;r--)i=e[r],i==="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--);if(t)while(n)e.unshift(".."),n--;return e},t=function(t){var n=t.charAt(0)==="/",r=t.slice(-1)==="/";return t=e(t.split("/").filter(function(e){return!!e}),!n).join("/"),!t&&!n&&(t="."),t&&r&&(t+="/"),(n?"/":"")+t};return{normalize:t}}();var AjaxObject=function(e,t){var n=this;this.updating=!1,this.abort=function(){n.updating&&(n.updating=!1,n.AJAX.abort(),n.AJAX=null)},this.update=function(){return n.updating?!1:(n.AJAX=null,window.XMLHttpRequest?(n.AJAX=new XMLHttpRequest,n.AJAX.overrideMimeType&&n.AJAX.overrideMimeType("text/html")):n.AJAX=new ActiveXObject("Microsoft.XMLHTTP"),n.AJAX===null?!1:(n.AJAX.onreadystatechange=function(){n.AJAX.readyState===4&&(n.updating=!1,n.callback(n.AJAX.responseText,n.AJAX.status,n.AJAX.responseXML),n.AJAX=null)},n.updating=new Date,n.AJAX.open("GET",e,!0),n.AJAX.send(null),!0))},this.callback=t||function(){}};fs=function(){var e=function(e,t,n){var r=new AjaxObject(e,function(t,r){r<200||r>399?n(new Error("Failed to load template "+e)):n(undefined,t)});try{r.update()}catch(i){n(i)}},t=function(){};return{readFile:e,watch:t}}()}})();